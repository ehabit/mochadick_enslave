package enslave.entity.ai;

import net.minecraft.entity.ai.EntityAIBase;
import net.minecraft.entity.ai.RandomPositionGenerator;
import net.minecraft.pathfinding.PathNavigate;
import net.minecraft.util.ChunkCoordinates;
import net.minecraft.util.MathHelper;
import net.minecraft.util.Vec3;
import enslave.entity.EntityEnslavedVillager;;

public class AIReturnHome extends EntityAIBase
{
  private EntityEnslavedVillager theSlave;
  private double movePosX;
  private double movePosY;
  private double movePosZ;
  private int pathingDelay = 0;
  private int pathingDelayInc = 5;

  int count = 0;
  int prevX = 0;
  int prevY = 0;
  int prevZ = 0;

  public AIReturnHome(EntityGolemBase par1EntityCreature)
  {
    this.theSlave = par1EntityCreature;
    func_75248_a(3);
  }

  public boolean func_75250_a()
  {
    ChunkCoordinates home = this.theSlave.func_110172_bL();
    if (this.pathingDelay > 0) this.pathingDelay -= 1;
    if ((this.pathingDelay > 0) || (this.theSlave.func_70092_e(home.field_71574_a + 0.5F, home.field_71572_b + 0.5F, home.field_71573_c + 0.5F) < 3.0D)) {
      return false;
    }

    this.movePosX = (home.field_71574_a + 0.5D);
    this.movePosY = (home.field_71572_b + 0.5D);
    this.movePosZ = (home.field_71573_c + 0.5D);
    return true;
  }

  public boolean func_75253_b()
  {
    ChunkCoordinates home = this.theSlave.func_110172_bL();
    return (this.pathingDelay <= 0) && (this.count > 0) && (!this.theSlave.getNavigator().func_75500_f()) && (this.theSlave.func_70092_e(home.field_71574_a + 0.5F, home.field_71572_b + 0.5F, home.field_71573_c + 0.5F) >= 3.0D);
  }

  public void func_75251_c()
  {
  }

  public void updateTask()
  {
    this.count -= 1;
    if ((this.count == 0) && (this.prevX == MathHelper.floor_double(this.theSlave.posX)) && (this.prevY == MathHelper.floor_double(this.theSlave.posY)) && (this.prevZ == MathHelper.floor_double(this.theSlave.posZ))) {
      Vec3 var2 = RandomPositionGenerator.func_75463_a(this.theSlave, 2, 1);

      if (var2 != null)
      {
        this.count = 20;
        boolean path = this.theSlave.getNavigator().tryMoveToXYZ(var2.field_72450_a + 0.5D, var2.field_72448_b + 0.5D, var2.field_72449_c + 0.5D, this.theSlave.func_70689_ay());
        if (!path) {
          this.pathingDelay = this.pathingDelayInc;
          if (this.pathingDelayInc < 50) this.pathingDelayInc += 5; 
        }
        else { this.pathingDelayInc = 5; }

      }

    }

    super.updateTask();
  }

  public void func_75249_e()
  {
    this.count = 20;
    this.prevX = MathHelper.floor_double(this.theSlave.posX);
    this.prevY = MathHelper.floor_double(this.theSlave.posY);
    this.prevZ = MathHelper.floor_double(this.theSlave.posZ);
    boolean path = this.theSlave.getNavigator().tryMoveToXYZ(this.movePosX, this.movePosY, this.movePosZ, this.theSlave.func_70689_ay());
    if (!path) {
      this.pathingDelay = this.pathingDelayInc;
      if (this.pathingDelayInc < 50) this.pathingDelayInc += 5; 
    }
    else { this.pathingDelayInc = 5; }

  }
}